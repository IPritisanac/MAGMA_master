#########
# MAGMA #
#########

MAGMA provides a collection of methods to define simple, undirected, labelled graphs on the basis of input structure (PDB) files and NMR data.
Note that technical documentation on every function will be automatically generated using Doxygen, and available in "doc" folder.

MAGMA main features:
- importing of PDB files, possibly containing multiple conformations (e.g. multi PDB)
- extraction of relevant atomic coordinates and generation of pseudoatoms (when so specified)
- generation of graph objects on the basis of atomic coordinates and inter-atomic distances
- generation of graph objects on the basis of chemical shift values and nuclear Overhauser enhancement rates' chemical shift values
- traversal of graph vertices using depth- or breadth-first search
- evaluation of similarity between the graphs using subgraph_isomorphism algorithm and/or MCES algorithm
- generation of mapping from the vertices of one graph (i.e. nmr data graph) to the vertices of another graph (i.e. structure graph)
  on the basis of subgraph isomorphism and/or maximal common edge subgraph

#################
# RUNNING MAGMA #
#################

- MAGMA can be run using Linux/Unix

- for a successful operation of MAGMA, you need to have:
		
			GNU Compiler Collection (GCC)
			python (version 2.7 or higher)
		
  and the following python site-packages: 

			numpy (__version__)
			matplotlib (__version__)
			igraph (__version__)
			networkx (__version__)
			munkres (__version__)
			
  installed on your system.

- MAGMA c-version (faster) is run from a command line as follows:

	$ python execute_magma.py /path/to/input/text/file c

- MAGMA python-version (slower) is run from a command line as follows:

	$ python execute_magma.py /path/to/input/text/file py
					
- examples for the input text files are given in directory benchmark/

last update of this document: 06.03.2017

################
# MAGMA OUTPUTS#
################

MAGMA calculation will create a subdirectory called 'results' in the directory where 'input_protein_name.txt' file is located

After a successful calculation the directory 'results/' will contain:
								
	. combined_result.res	-	this is the FINAL assignment file (relevant to the user!)
							-	in the first column 1H-13C peak identifier is given
							-	in the second and any nth column following ":" all residue assignment options for the peak are given
							
The rest of the outputs contain details of certain steps of the overall MAGMA protocol: 
(less relevant for the user, but useful in debugging and analysis of run progression)

	. hungarian_assignmentX.out - this is the assignment guess prior to execution of the exact MCES algorithm (relevant to the user!)
								- in case the calculation takes very long to converge -- this assignment
								  can be treated as the best guess, approximate assignment
								- X - full for "all_subgraphs" mode
								- X - subgraph numerical id for "connected_subgraphs" mode
								

							
	. conv.2.x.out	-	text file monitoring details of the first step of MAGMA optimization prior to execution of complete MCES search
					-	for each step of iterative optimization (column 1) enumerate how many vertices (column 3) have scored a particular score (column 2)

	. conv.1.x.out	-	text file monitoring progress of the second step of MAGMA optimization prior to execution of complete MCES search
	 				-	for each step of iterative optimization (column 1) store the score of collected mces (column 2)
	
	. a subdirectory 'core/' with files:
		
		. 'final.out' - 	this is the assignment of the last connected subgraph (or in case of all_subgraphs run mode) the assignment result;
							(not relevant to the user)
														
		. 'mcesCore.init' - this is the output of MAGMA's initial optimization that is used by the program (not relevant to the user)

	. files:
		
		. mces_n.txt	-	lists all mces solutions found by McGregor algorithm for the nth connected subgraph of the nmr data graph
		. mces_n.txt.B
		. mces_n.txt.G
		. vf2_n.txt	-	consolidation of assignment through subgraph isomorphism, using VF2 algorithm, for the nth connected subgraph of the nmr data graph

###########
# CREDITS #
###########

author: Iva Pritisanac (iva.pritisanac@gmail.com), University of Oxford

other contributions:

  . classes Parser, Molecule and Structure -- Matteo Degiacomi (matteo.degiacomi@chem.ox.ac.uk), University of Oxford
  . re-implementation of core McGregor MCES algorithm in C on the basis of author's original Python version -- Andrew Baldwin (andrew.baldwin@chem.ox.ac.uk), University of Oxford
  .	convergence monitoring, and output files for the C version of McGregor MCES algorithm -- Andrew Baldwin (andrew.baldwin@chem.ox.ac.uk), University of Oxford
  . implementation of subgraph isomorphism algorithm from igraph --The network analysis package (igraph.org)
  . implementation of Hungarian algorithm from the python package munkres 1.0.7 -- (https://pypi.python.org/pypi/munkres/)
  . graph objects definitions, manipulations, and plotting python package networkx 1.9.1 -- (https://pypi.python.org/pypi/networkx/)
  . implementation of algorithm for graph breadth first search python package networkx 1.9.1 -- (https://pypi.python.org/pypi/networkx/)
  
#############################
# TO DO/ONGOING DEVELOPMENT #
#############################

- automatic iteration over a user specified range of distance thresholds to define an optimal threshold [Status: ONGOING]
- a call to mcgregor method to enable mode merge_proRS 'off' mode after the calculation in mode merge_proRS 'on' [Status: ONGOING]
- cython the slowest python functions 

##############
# KNOWN BUGS #
##############

- method remove_small_subgraphs of class Graph occasionally fails (unknown reason) [Current treatment: Exception]
- method reprioritize of class McGregor (unknown reason) [Current treatment: None]

###############
# UPDATES LOG #
###############

--------------
06.03.2017
--------------

- IP: compiled this version on the basis of earlier MAGMA version (documented elsewhere)

################
# NOTE TO USERS#
################

- to report bugs or suggest developments please contact: iva.pritisanac@gmail.com
- have fun using MAGMA :-)